server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;

    location /1/ {
        # Usamos la cache con key 'global'.
        proxy_cache global;
        # Generamos una clave unica usando la URL.
        proxy_cache_key $request_uri$is_args$args;
        # Las respuestas de tipo 200 son validas por 8h.
        proxy_cache_valid 200 1d;

        # Ponemos el header para saber el estado de la cache.
        add_header X-Proxy-Cache $upstream_cache_status;

        # Habilitamos SSL para poder hacer proxy_pass a una URL HTTPS.
        proxy_ssl_server_name on;
        proxy_pass https://mockbin.org/bin/cbfdbe04-bab5-4dbe-a6aa-a3121d71c990;
    }

    location /2/ {
        # Usamos la cache con key 'user'.
        proxy_cache user;
        # Generamos una clave unica usando la URL. Al principio usamos el Bearer para segmentar por usuario.
        proxy_cache_key $http_authorization$request_uri$is_args$args;
        # Las respuestas de tipo 200 son validas por 2h.
        proxy_cache_valid 200 2h;

        # Ponemos el header para saber el estado de la cache.
        add_header X-Proxy-Cache $upstream_cache_status;

        # Habilitamos SSL para poder hacer proxy_pass a una URL HTTPS.
        proxy_ssl_server_name on;
        proxy_pass http://mockbin.org/bin/d12ac0e7-b594-43d7-b228-2042030e04f0;
    }

    location /3/ {
        proxy_ssl_server_name on;
        proxy_pass http://mockbin.org/bin/77ce4fa3-7d45-4e12-bb36-fd68bc9dcc93;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}

